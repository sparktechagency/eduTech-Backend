name: Update README

on:
  schedule:
    - cron: '0 */6 * * *' # Runs every 6 hours
  workflow_dispatch:

# ‡ßß. ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ (Organization Repo-‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ü‡¶ø ‡¶¨‡¶æ‡¶ß‡ßç‡¶Ø‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï)
permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Update README with recent activity
        uses: jamesgeorge007/github-activity-readme@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          COMMIT_MSG: '‚ö° Update README with recent activity'
          MAX_LINES: 5

  update-quote:
    needs: update-readme
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      # ‡ß®. Python ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶ï‡¶∞‡¶æ
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # ‡ß©. ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®‡ßá‡¶∞ ‡¶¨‡¶¶‡¶≤‡ßá ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞
      - name: Update Quote with Python
        env: 
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤
          pip install requests

          # ‡¶™‡¶æ‡¶á‡¶•‡¶® ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡ßã
          python -c "
          import requests
          import re
          import os

          try:
              response = requests.get('https://api.quotable.io/random?maxLength=50')
              if response.status_code == 200:
                  data = response.json()
                  quote = f\"{data['content']} - {data['author']}\"
                  print(f'Got quote: {quote}')
                  
                  # README ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                  with open('README.md', 'r') as f:
                      content = f.read()
                  
                  # Regex used to replace the existing quote (if any) with the new one
                  new_content = re.sub(
                      r'.*',
                      f'\n{quote}\n',
                      content,
                      flags=re.DOTALL
                  )
                  
                  with open('README.md', 'w') as f:
                      f.write(new_content)
              else:
                  print('Failed to fetch quote')
          except Exception as e:
              print(f'Error: {e}')
          "

      # ‡ß™. commit and push
      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          # ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶¨‡ßá ‡¶è‡¶∞‡¶∞ ‡¶¶‡¶ø‡¶¨‡ßá ‡¶®‡¶æ
          git commit -m "üìù Update quote" || exit 0
          git push